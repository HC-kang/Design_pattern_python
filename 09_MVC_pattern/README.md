## 9장. MVC 패턴

### 1. MVC 패턴 개요

MVC 패턴은 사실 단일 패턴이라기보다는 일종의 컴파운드 패턴으로 볼 수 있다.  
MVC는 각각 모델, 뷰, 컨트롤러를 의미하며, 이 세가지 구성요소가 맞물려 유저 인터페이스를 구성한다. 여기서 모델은 데이터와 비즈니스 로직을 처리하는 부분이고, 뷰는 모델로부터 받은 데이터를 사용자가 보기 좋게 시각적으로 표현한다. 컨트롤러는 사용자의 요청에 따라 모델과 뷰 사이에서 요청을 처리한다.  
중요한 점은, 뷰와 컨트롤러는 모델에 의존하지만 모델은 뷰와 컨트롤러에 의존하지 않는다. 이러한 점이 MVC 패턴의 중요한 점이다.

#### MVC 패턴의 예시

- 사용자는 뷰를 통해 시스템에 요청을 보낸다. 쉽게 말하면, 웹사이트에 있는 버튼을 클릭하여 컨트롤러로 요청을 전달한다.
- 컨트롤러는 뷰에서 받은 인자를 모델로 보낸다. 이에따라 모델은 요청에 걸맞는 작업을 수행한다.
- 컨트롤러는 사용자의 요청에 따라 버튼 교체나 UI 추가 변경을 뷰에 지시할 수 있다.
- 모델은 내부 로직이나 버튼클릭 등의 트리거에 의한 상태변경을 뷰에 알린다.
- 뷰는 모델이 전달해준 상태와 데이터를 출력한다.

#### MVC 패턴의 목적

- 데이터를 조작하는 비즈니스 로직과, 사용자가 접하는 표현계층이 독립되어 있어 유지보수 소요를 줄일 수 있음.
- 데이터 저장, 표현방식의 수정 등이 자유로워 필요시 쉽게 수정 할 수 있음.

#### MVC 패턴의 장단점

1. 장점
   - 애플리케이션의 구조를 파트별로 나누어, 높은 독립성을 유지할 수 있고, 이로인해 유지보수 소요가 줄어든다.
   - 백엔드의 로직을 거의 건드리지 않고 뷰의 로직을 수정 할 수 있다.
   - 반대로, 비즈니스 로직도 뷰를 거의 건드리지 않고 수정 할 수 있다.
   - 컨트롤러 또한 대부분 독립적으로 수정 할 수 있다.
   - 다시 말하자면, 각각 특정 분야의 전문가들이 독립적으로 일할 수 있는 환경을 제공한다.
2. 단점
   - 클래스가 상대적으로 많아 관리할 것이 많다
   - 서비스가 대형화되면 모델과 뷰, 컨트롤러의 상호관계가 비대해지고 지나치게 복잡해진다
   - 최근에는, 오히려 모델과 뷰가 의존성이 높다는 의견도 많다.

#### <MVC 패턴의 구성>

![MVC_structure](https://user-images.githubusercontent.com/81678439/158713384-51b9b26e-4ca7-4f2e-923d-365f1d169dd5.png)  
MVC 패턴은 총 4개의 클래스로 구성된다.

1. 모델: 애플리케이션의 뇌
   - 데이터를 저장하고 수정, 생성 및 삭제 등 각종 작업을 수행하는 클래스
   - 모델은 뷰와 컨트롤러와는 독립적이지만, 뷰와 컨트롤러는 모델에 의존적임.
   - 사용자가 요청한 데이터를 제공하며, 필요시 상태정보와 상태를 변경하는 메소드를 가지고있으나 자신이 제공한 데이터가 사용자에게 어떻게 보여지는지는 알지 못함.
   - 모델은 반드시 여러 작업 간 일관성을 가져야 함.
2. 뷰: 외모
   - 유저 인터페이스와 데이터의 시각적 표현을 담당하는 클래스.
   - 필요시 뷰를 독립적으로 작성 할 수 있음. 그렇지만 애플리케이션에 필요한 웹이나 GUI를 생성하는 메소드를 포함하되, 그 외 개별적인 로직을 포함하면 안됨 이러한 복잡한 로직은 모델이나 컨트롤러에 포함되어야 함.
   - 특히, 최근 다양한 기기에 대응하기위한 반응형 웹 구축을 위해서는 최대한 유연한 형태를 띄어야 함.
   - 뷰는 데이터베이스와 절대 직접 통신하지 않고, 모델에 의존해야 함.
3. 컨트롤러: 접착제
   - 모델과 뷰를 연결하는 클래스 사용자의 행동을 제어함.
   - 요청을 라우팅하는 메소드를 포함함.
   - 컨트롤러는 DB를 직접 호출하거나 데이터를 시각화하지 않음. 이러한 역할은 각각 모델과 뷰가 실행하고, 컨트롤러는 둘 사이에서 접착제 역할을 함.
4. 클라이언트: 목적에 따라 정보를 요청하는 클래스

#### <MVC 패턴 UML 다이어그램>

![MVC_pattern](https://user-images.githubusercontent.com/81678439/158712787-253e2dcf-1c35-4b72-b40f-4c63df4ba4c4.png)

- Model: 비즈니스 로직이나 클라이언트의 요청을 수행하는 작업을 정의
- View: 모델에서 전달받은 데이터를 바탕으로, 클라이언트가 보는 시각적 표현을 정의
- Controller: 뷰와 모델 사이의 인터페이스 역할. 클라이언트 요청을 뷰에서 모델로 전달

### 2. MVC 패턴 예제(코드참조)

#### 01_MVC.py

- 코드의 한계로 뷰가 아닌 컨트롤러를 직접 호출하였음.
- 그렇지만 컨트롤러가 요청을 모델에 전달하고, 모델이 가지고있는 데이터를 가져다 다시 뷰에 전달하는 형태를 확인 할 수 있음.

#### 02_MVC.py

- 생략(코드참조)

#### 03_tornado.py

- 파이썬에서 일반적으로 사용하는 장고는, MVC와 유사한 MTV(모델, 템플릿, 뷰) 패턴을 사용한다. 그러나 여기서는 또다른 웹 프레임워크인 Tornado를 활용한다.

  > Tornado == 4.3  
  > SQlite3 == 2.6.0

- IndexHandler: 데이터베이스에 저장된 모든 Todo-List를 SELECT 연산을 통해 dict 형태로 반환함.
- NewHandler: 필요시 테이블을 생성하고 INSERT 연산으로 새로운 Todo-List를 입력함.
- UpdateHandler: UPDATE 연산을 통해 특정 일정의 상태를 조정하여 완료, 재개 처리한다.
- DeleteHandler: DELETE 연산으로 특정 일정을 삭제한다.
- 각 메소드의 'self.render()': MVC의 뷰에 해당하는 부분
- 애플리케이션 경로(route): MVC의 컨트롤러 부분. 여기서는 아래의 네 가지가 존재함.
  - /: 모든 일정 보기
  - /todo/new: 새 일정 생성
  - /todo/update: 일정의 상태 변경
  - /todo/delete: 일정을 삭제
